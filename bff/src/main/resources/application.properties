# --- OIDC (必須) ---
quarkus.oidc.application-type=web-app
quarkus.oidc.auth-server-url=http://keycloak:8080/realms/demo-realm
quarkus.oidc.client-id=bff
# 公開クライアント(PKCE)で動かすため client-secret は使わない
# quarkus.oidc.credentials.secret=${OIDC_CLIENT_SECRET:bff-secret}

# ★ コールバックを /secure/callback に固定（Quarkus がここを待ち受け）
quarkus.oidc.authentication.redirect-path=/secure/callback

# ---- PKCE を必須化（Keycloak 側の要件に合わせる）----
quarkus.oidc.authentication.pkce-required=true
# code_verifier などを安全に保持するための鍵（32文字以上）
quarkus.oidc.authentication.state-secret=change-me-32chars-or-more-0123456789abcdef

# セッションCookie暗号鍵（32文字以上・推奨）
quarkus.oidc.token-state-manager.encryption-secret=another-32chars-secret-abcdef0123456789

# ---- 逆プロキシ（Kong）配下での必須設定 ----
quarkus.http.proxy.proxy-address-forwarding=true
quarkus.http.proxy.enable-forwarded-host=true
quarkus.http.proxy.enable-forwarded-prefix=true

# ---- Cookie の動作 ----
quarkus.oidc.authentication.cookie-path=/
quarkus.oidc.authentication.cookie-same-site=lax
quarkus.oidc.authentication.cookie-force-secure=false

# ---- ログ ----
quarkus.config.log.values=true
quarkus.log.category."io.quarkus.oidc".level=DEBUG

# ---- スコープ ----
# openid は Quarkus が既定で自動付与する
quarkus.oidc.authentication.add-openid-scope=true
# ※ スペース区切り！カンマやドットはNG（profile.email など）
quarkus.oidc.authentication.scopes=profile email

# ↓ 組み込みのログアウトを /secure/logout で有効化し、完了後 /app/ に戻す
quarkus.oidc.logout.path=/secure/logout
quarkus.oidc.logout.post-logout-path=/app/


# --
# === upstream REST clients ===
quarkus.rest-client.savings.url=http://savings-service:8081
quarkus.rest-client.timedeposit.url=http://time-deposit-service:8082

# （参考）タイムアウトは ms 単位でOK（起動エラーを避ける書き方）
quarkus.rest-client.savings.connect-timeout=5000
quarkus.rest-client.savings.read-timeout=15000
quarkus.rest-client.timedeposit.connect-timeout=5000
quarkus.rest-client.timedeposit.read-timeout=15000

# CORS（フロントが :8000 で動く前提）
quarkus.http.cors=true
quarkus.http.cors.origins=http://localhost:8000
quarkus.http.cors.methods=GET,POST,OPTIONS
quarkus.http.cors.headers=accept,authorization,content-type
quarkus.http.cors.access-control-allow-credentials=true


# === Downstream: savings-service ===

# JSON (必要なら)
quarkus.jackson.accept-case-insensitive-enums=true



# セッションを伸ばす（既定 5M → 30M）
quarkus.oidc.authentication.session-age-extension=30M

# 期限切れ前に先回りリフレッシュ（Duration）
quarkus.oidc.token.refresh-token-time-skew=30S

# 時計ずれ等の猶予（整数秒）
quarkus.oidc.token.lifespan-grace=30

# （明示したい場合のみ。上の time-skew を設定すると自動有効）
quarkus.oidc.token.refresh-expired=true
